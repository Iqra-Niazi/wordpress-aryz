var clientSecret=null;$(function(){function getPayButton(){var stripe=Stripe("pk_live_51Hw4iYJFAQeMdV8rwLplq122ZKq8fiL6h201DZRxedJWbtdwY4CEdcW0ZOkw8oPea0qNiY2rOnnsq4HDbWgVv9Ko00CRHiB8UX");var form_data=new FormData();form_data.append('action','payment__info');order_info.info=!0;form_data.append('body',JSON.stringify(order_info));fetch("/wp-admin/admin-ajax.php",{method:'post',body:form_data,}).then(function(result){return result.clone().json()}).then(function(data){clientSecret=data.client_secret;if(typeof data.error!='undefined'){alert('Error starting payment: '+data.error)}else{var paymentRequest1=stripe.paymentRequest({'country':data.applePayRequest.country,'currency':data.applePayRequest.currency,total:{label:'Price total',amount:data.applePayRequest.amount,},requestPayerName:!0,requestPayerEmail:!0,});var elements=stripe.elements();var prButton=elements.create('paymentRequestButton',{paymentRequest:paymentRequest1,style:{paymentRequestButton:{type:'buy',theme:'light-outline',height:'40px'},},});paymentRequest1.canMakePayment().then(function(result){if(result){prButton.mount('#payment-request-button')}else{document.getElementById('payment-request-button').style.display='none'}});paymentRequest1.on('paymentmethod',function(ev){stripe.confirmCardPayment(clientSecret,{payment_method:ev.paymentMethod.id},{handleActions:!1}).then(function(confirmResult){if(confirmResult.error){ev.complete('fail');alert(confirmResult.error)}else{ev.complete('success');if(confirmResult.paymentIntent.status==="requires_action"){stripe.confirmCardPayment(clientSecret).then(function(result){if(result.error){alert(result.error)}else{order_create_ajax(confirmResult.paymentIntent.id)}})}else{order_create_ajax(confirmResult.paymentIntent.id)}}})})}})}
var countryStripe=[{country:'Australia',code:'AU'},{country:'Austria',code:'AT'},{country:'Belgium',code:'BE'},{country:'Bulgaria',code:'BG'},{country:'Brazil ',code:'BR'},{country:'Canada',code:'CA'},{country:'Cyprus',code:'CY'},{country:'Czech Republic',code:'CZ'},{country:'Denmark',code:'DK'},{country:'Estonia',code:'EE'},{country:'Finland',code:'FI'},{country:'France',code:'FR'},{country:'Germany',code:'DE'},{country:'Greece',code:'GR'},{country:'Hong Kong',code:'HK'},{country:'Hungary',code:'HU'},{country:'India',code:'IN'},{country:'Ireland',code:'IE'},{country:'Italy',code:'IT'},{country:'Japan',code:'JP'},{country:'Latvia',code:'LV'},{country:'Lithuania',code:'LT'},{country:'Luxembourg',code:'LU'},{country:'Malaysia',code:'MY'},{country:'Malta',code:'MT'},{country:'Mexico ',code:'MX'},{country:'Netherlands',code:'NL'},{country:'New Zealand',code:'NZ'},{country:'Norway',code:'NO'},{country:'Poland',code:'PL'},{country:'Portugal',code:'PT'},{country:'Romania',code:'RO'},{country:'Singapore',code:'SG'},{country:'Slovakia',code:'SK'},{country:'Slovenia',code:'SI'},{country:'Spain',code:'ES'},{country:'Sweden',code:'SE'},{country:'Switzerland',code:'CH'},{country:'United Kingdom',code:'GB'},{country:'United States',code:'US'}]
function isAnyValueIn(target,values){for(var i=0;i<values.length;i++){if(target.indexOf(values[i].code)>-1){return!0}}
return!1}
$('.final_step-applepay').click(function(){var countrySelect=$('select[name="order_address_country"]').val();if(isAnyValueIn(countrySelect,countryStripe)){getPayButton()}})});
